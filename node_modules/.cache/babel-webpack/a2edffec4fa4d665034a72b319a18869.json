{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/romerosp/source/repos/Angular/CRUD_Firebase_invitados/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { InviteDialogConfirmComponent } from './../invite-dialog-confirm/invite-dialog-confirm.component';\nimport { SheetComponent } from './../sheet/sheet.component';\nimport { DialogConfirmComponent } from './../dialog-confirm/dialog-confirm.component';\nimport { DialogAddComponent } from './../dialog-add/dialog-add.component';\nimport { DataService } from '../../services/data.service';\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { take } from 'rxjs/operators';\nlet FormComponent = class FormComponent {\n  constructor(fb, dataService, router, _snackBar, dialog, _bottomSheet) {\n    var _a, _b, _c, _d, _e;\n\n    this.fb = fb;\n    this.dataService = dataService;\n    this.router = router;\n    this._snackBar = _snackBar;\n    this.dialog = dialog;\n    this._bottomSheet = _bottomSheet;\n    this.sexoList = [];\n    this.parentescoList = [];\n    this.stateForm = 0;\n    this.grupos = [];\n    this.panelOpenState = false;\n    var navi = this.router.getCurrentNavigation();\n    this.persona = (_a = navi === null || navi === void 0 ? void 0 : navi.extras) === null || _a === void 0 ? void 0 : _a.state;\n    this.states = {\n      new: 1,\n      edit: 2\n    };\n    this.stateForm = this.getState();\n    this.sexoList = [\"Hombre\", \"Mujer\"];\n    this.parentescoList = [\"Padre\", \"Madre\", \"Hermano/a\", \"Tio/a\", \"Primo/a\", \"Abuelo/a\", \"Amigo/a\", \"Cuñado/a\", \"Otro\"];\n    this.sexoInvitado = ((_b = this.persona) === null || _b === void 0 ? void 0 : _b.sexo) || \"\";\n    this.clasificacion = ((_c = this.persona) === null || _c === void 0 ? void 0 : _c.clasificacion) || \"\";\n    this.clasificacionList = [\"Adulto\", \"Joven\", \"Niño\"];\n    this.parentescoInvitado = ((_d = this.persona) === null || _d === void 0 ? void 0 : _d.parentesco) || \"\";\n    this.grupoInvitado = ((_e = this.persona) === null || _e === void 0 ? void 0 : _e.grupo) || \"\";\n    this.initForm();\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this.stateForm === _this.states.edit) {\n        _this.invitadoForm.patchValue(_this.persona);\n      }\n\n      _this.patchGrupo();\n    })();\n  }\n\n  patchGrupo() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this2.persona !== undefined) {\n        yield _this2.dataService.grupos.subscribe(grupos => {\n          var _a;\n\n          _this2.grupoSelected = grupos.find(x => x.id === _this2.persona.grupo);\n          _this2.grupoInvitado = (_a = _this2.grupoSelected) === null || _a === void 0 ? void 0 : _a.id;\n        });\n      }\n    })();\n  }\n\n  onSave() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      if (_this3.invitadoForm.valid) {\n        try {\n          const invitado = _this3.invitadoForm.value;\n          invitado.grupo = _this3.grupoInvitado;\n          invitado.id = ((_a = _this3.persona) === null || _a === void 0 ? void 0 : _a.id) || null;\n          yield _this3.dataService.addInvitado(invitado);\n\n          if (_this3.stateForm == _this3.states.new) {\n            //Swal.fire('Invitado añadido', 'Puedes verlo en la lista', 'success');\n            _this3.openSnackBar('Invitado añadido correctamente', 'Ok', 'bg-success');\n\n            _this3.invitadoForm.reset();\n\n            _this3.initForm();\n          } else if (_this3.stateForm == _this3.states.edit) {\n            //Swal.fire('Invitado editado', 'Pulsa Ok Para volver a la lista', 'success');\n            _this3.openSnackBar('Invitado Editado correctamente', 'Ok', 'bg-success');\n\n            _this3.router.navigate(['home']);\n          }\n\n          _this3.invitadoForm.controls['invitado'].markAsTouched();\n\n          _this3.invitadoForm.controls['confirmado'].markAsTouched();\n        } catch (e) {\n          console.error(e);\n        }\n      } else {\n        //Swal.fire('Oops...', 'Comprueba los datos del formulario', 'error');\n        _this3.openSnackBar('Oops... Comprueba los datos del formulario', 'Ok', 'bg-danger');\n      }\n    })();\n  }\n\n  isValidField(field) {\n    const validatedField = this.invitadoForm.get(field);\n    return !(validatedField === null || validatedField === void 0 ? void 0 : validatedField.valid) && (validatedField === null || validatedField === void 0 ? void 0 : validatedField.touched) ? 'is-invalid' : (validatedField === null || validatedField === void 0 ? void 0 : validatedField.touched) ? 'is-valid' : '';\n  }\n\n  notRequiredHasValue(field) {\n    var _a;\n\n    return ((_a = this.invitadoForm.get(field)) === null || _a === void 0 ? void 0 : _a.value) ? 'is-valid' : '';\n  }\n\n  initForm() {\n    this.invitadoForm = this.fb.group({\n      nombre: ['', [Validators.required]],\n      apellidos: [''],\n      clasificacion: ['Adulto', [Validators.required]],\n      sexo: ['Hombre', [Validators.required]],\n      parentesco: ['Padre', [Validators.required]],\n      ubicacion: [''],\n      invitado: [false, [Validators.required]],\n      confirmado: [false, [Validators.required]],\n      grupo: ['hUNpRRMnt5nL3kuz0yiK', [Validators.required]] //Id del grupo 'Sin Grupo' en firestore\n\n    });\n  }\n\n  getState() {\n    return this.persona && typeof (this.persona !== undefined) ? 2 : 1;\n  }\n\n  goToDelete(id) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const dialogRefDelete = _this4.dialog.open(DialogConfirmComponent, {\n        width: '250px',\n        data: {\n          title: \"Eliminar invitado\",\n          subtitle: \"¿Seguro que quieres eliminar este invitado? Esta acción no se puede deshacer\",\n          isGroup: false,\n          data: null\n        }\n      });\n\n      dialogRefDelete.afterClosed().subscribe( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (result) {\n          if (result) {\n            try {\n              yield _this4.dataService.deleteInvitado(id); //Swal.fire('Invitado eliminado', 'Se ha eliminado el invitado correctamente', 'success');\n\n              _this4.openSnackBar('Invitado eliminado correctamente', 'Ok', 'bg-success');\n\n              _this4.router.navigate(['home']);\n            } catch (err) {\n              //Swal.fire('Oops...', 'Hubo un error al eliminar al invitado', 'error');\n              _this4.openSnackBar('Oops...Hubo un error al eliminar el invitado', 'Ok', 'bg-danger');\n            }\n          }\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n\n  openSnackBar(message, action, type) {\n    this._snackBar.open(message, action, {\n      duration: 2000,\n      panelClass: [type]\n    });\n  }\n\n  SelectGroup(gr) {\n    this.grupoSelected = gr;\n    this.grupoInvitado = gr.id;\n  }\n\n  changeInvite(grupo, invite) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      var invitadosGroup;\n\n      _this5.dataService.invitados.pipe(take(1)).subscribe(invitados => {\n        invitadosGroup = invitados.filter(x => x.grupo == grupo);\n\n        let dialogRef = _this5.dialog.open(InviteDialogConfirmComponent, {\n          width: '300px',\n          data: {\n            invite: invite,\n            personas: invitadosGroup\n          }\n        });\n\n        dialogRef.afterClosed().pipe(take(1)).subscribe(result => {\n          if (result) {\n            try {\n              _this5.persona.invitado = invite;\n\n              _this5.invitadoForm.controls['invitado'].setValue(invite);\n\n              invitadosGroup.forEach( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator(function* (inviGr) {\n                  try {\n                    inviGr.invitado = invite;\n                    yield _this5.dataService.addInvitado(inviGr);\n                  } catch (e) {\n                    _this5.openSnackBar('Oops...Hubo un error al invitar a ' + inviGr.nombre + \" \" + inviGr.apellidos, 'Ok', 'bg-danger');\n                  }\n                });\n\n                return function (_x2) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            } catch (err) {\n              //Swal.fire('Oops...', 'Hubo un error al eliminar al invitado', 'error');\n              console.error(err);\n\n              _this5.openSnackBar('Oops...Hubo un error al eliminar el invitado', 'Ok', 'bg-danger');\n            }\n          }\n        });\n      });\n    })();\n  }\n\n  openDialog() {\n    const dialogRef = this.dialog.open(DialogAddComponent, {\n      width: '250px',\n      data: {\n        persona: this.persona\n      }\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      if (result !== undefined) {\n        this.grupoSelected = result;\n        this.grupoInvitado = result.id;\n      }\n    });\n  }\n\n  openBottomSheet() {\n    const bottomSheet = this._bottomSheet.open(SheetComponent, {\n      data: this.grupoSelected\n    });\n\n    bottomSheet.afterDismissed().subscribe(result => {\n      if (result !== undefined) {\n        this.grupoSelected = result;\n        this.grupoInvitado = result.id;\n      }\n    });\n  }\n\n};\nFormComponent = __decorate([Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  providers: [DataService]\n})], FormComponent);\nexport { FormComponent };","map":{"version":3,"sources":["C:/Users/romerosp/source/repos/Angular/CRUD_Firebase_invitados/src/app/shared/components/form/form.component.ts"],"names":["__decorate","InviteDialogConfirmComponent","SheetComponent","DialogConfirmComponent","DialogAddComponent","DataService","Component","Validators","take","FormComponent","constructor","fb","dataService","router","_snackBar","dialog","_bottomSheet","_a","_b","_c","_d","_e","sexoList","parentescoList","stateForm","grupos","panelOpenState","navi","getCurrentNavigation","persona","extras","state","states","new","edit","getState","sexoInvitado","sexo","clasificacion","clasificacionList","parentescoInvitado","parentesco","grupoInvitado","grupo","initForm","ngOnInit","invitadoForm","patchValue","patchGrupo","undefined","subscribe","grupoSelected","find","x","id","onSave","valid","invitado","value","addInvitado","openSnackBar","reset","navigate","controls","markAsTouched","e","console","error","isValidField","field","validatedField","get","touched","notRequiredHasValue","group","nombre","required","apellidos","ubicacion","confirmado","goToDelete","dialogRefDelete","open","width","data","title","subtitle","isGroup","afterClosed","result","deleteInvitado","err","message","action","type","duration","panelClass","SelectGroup","gr","changeInvite","invite","invitadosGroup","invitados","pipe","filter","dialogRef","personas","setValue","forEach","inviGr","openDialog","openBottomSheet","bottomSheet","afterDismissed","selector","templateUrl","styleUrls","providers"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\r\nimport { InviteDialogConfirmComponent } from './../invite-dialog-confirm/invite-dialog-confirm.component';\r\nimport { SheetComponent } from './../sheet/sheet.component';\r\nimport { DialogConfirmComponent } from './../dialog-confirm/dialog-confirm.component';\r\nimport { DialogAddComponent } from './../dialog-add/dialog-add.component';\r\nimport { DataService } from '../../services/data.service';\r\nimport { Component } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\nimport { take } from 'rxjs/operators';\r\nlet FormComponent = class FormComponent {\r\n    constructor(fb, dataService, router, _snackBar, dialog, _bottomSheet) {\r\n        var _a, _b, _c, _d, _e;\r\n        this.fb = fb;\r\n        this.dataService = dataService;\r\n        this.router = router;\r\n        this._snackBar = _snackBar;\r\n        this.dialog = dialog;\r\n        this._bottomSheet = _bottomSheet;\r\n        this.sexoList = [];\r\n        this.parentescoList = [];\r\n        this.stateForm = 0;\r\n        this.grupos = [];\r\n        this.panelOpenState = false;\r\n        var navi = this.router.getCurrentNavigation();\r\n        this.persona = (_a = navi === null || navi === void 0 ? void 0 : navi.extras) === null || _a === void 0 ? void 0 : _a.state;\r\n        this.states = { new: 1, edit: 2 };\r\n        this.stateForm = this.getState();\r\n        this.sexoList = [\"Hombre\", \"Mujer\"];\r\n        this.parentescoList = [\"Padre\", \"Madre\", \"Hermano/a\", \"Tio/a\", \"Primo/a\", \"Abuelo/a\", \"Amigo/a\", \"Cuñado/a\", \"Otro\"];\r\n        this.sexoInvitado = ((_b = this.persona) === null || _b === void 0 ? void 0 : _b.sexo) || \"\";\r\n        this.clasificacion = ((_c = this.persona) === null || _c === void 0 ? void 0 : _c.clasificacion) || \"\";\r\n        this.clasificacionList = [\"Adulto\", \"Joven\", \"Niño\"];\r\n        this.parentescoInvitado = ((_d = this.persona) === null || _d === void 0 ? void 0 : _d.parentesco) || \"\";\r\n        this.grupoInvitado = ((_e = this.persona) === null || _e === void 0 ? void 0 : _e.grupo) || \"\";\r\n        this.initForm();\r\n    }\r\n    async ngOnInit() {\r\n        if (this.stateForm === this.states.edit) {\r\n            this.invitadoForm.patchValue(this.persona);\r\n        }\r\n        this.patchGrupo();\r\n    }\r\n    async patchGrupo() {\r\n        if (this.persona !== undefined) {\r\n            await this.dataService.grupos.subscribe(grupos => {\r\n                var _a;\r\n                this.grupoSelected = grupos.find(x => x.id === this.persona.grupo);\r\n                this.grupoInvitado = (_a = this.grupoSelected) === null || _a === void 0 ? void 0 : _a.id;\r\n            });\r\n        }\r\n    }\r\n    async onSave() {\r\n        var _a;\r\n        if (this.invitadoForm.valid) {\r\n            try {\r\n                const invitado = this.invitadoForm.value;\r\n                invitado.grupo = this.grupoInvitado;\r\n                invitado.id = ((_a = this.persona) === null || _a === void 0 ? void 0 : _a.id) || null;\r\n                await this.dataService.addInvitado(invitado);\r\n                if (this.stateForm == this.states.new) {\r\n                    //Swal.fire('Invitado añadido', 'Puedes verlo en la lista', 'success');\r\n                    this.openSnackBar('Invitado añadido correctamente', 'Ok', 'bg-success');\r\n                    this.invitadoForm.reset();\r\n                    this.initForm();\r\n                }\r\n                else if (this.stateForm == this.states.edit) {\r\n                    //Swal.fire('Invitado editado', 'Pulsa Ok Para volver a la lista', 'success');\r\n                    this.openSnackBar('Invitado Editado correctamente', 'Ok', 'bg-success');\r\n                    this.router.navigate(['home']);\r\n                }\r\n                this.invitadoForm.controls['invitado'].markAsTouched();\r\n                this.invitadoForm.controls['confirmado'].markAsTouched();\r\n            }\r\n            catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n        else {\r\n            //Swal.fire('Oops...', 'Comprueba los datos del formulario', 'error');\r\n            this.openSnackBar('Oops... Comprueba los datos del formulario', 'Ok', 'bg-danger');\r\n        }\r\n    }\r\n    isValidField(field) {\r\n        const validatedField = this.invitadoForm.get(field);\r\n        return !(validatedField === null || validatedField === void 0 ? void 0 : validatedField.valid) && (validatedField === null || validatedField === void 0 ? void 0 : validatedField.touched)\r\n            ? 'is-invalid'\r\n            : (validatedField === null || validatedField === void 0 ? void 0 : validatedField.touched)\r\n                ? 'is-valid'\r\n                : '';\r\n    }\r\n    notRequiredHasValue(field) {\r\n        var _a;\r\n        return ((_a = this.invitadoForm.get(field)) === null || _a === void 0 ? void 0 : _a.value) ? 'is-valid' : '';\r\n    }\r\n    initForm() {\r\n        this.invitadoForm = this.fb.group({\r\n            nombre: ['', [Validators.required]],\r\n            apellidos: [''],\r\n            clasificacion: ['Adulto', [Validators.required]],\r\n            sexo: ['Hombre', [Validators.required]],\r\n            parentesco: ['Padre', [Validators.required]],\r\n            ubicacion: [''],\r\n            invitado: [false, [Validators.required]],\r\n            confirmado: [false, [Validators.required]],\r\n            grupo: ['hUNpRRMnt5nL3kuz0yiK', [Validators.required]], //Id del grupo 'Sin Grupo' en firestore\r\n        });\r\n    }\r\n    getState() {\r\n        return this.persona && typeof (this.persona !== undefined) ? 2 : 1;\r\n    }\r\n    async goToDelete(id) {\r\n        const dialogRefDelete = this.dialog.open(DialogConfirmComponent, {\r\n            width: '250px',\r\n            data: { title: \"Eliminar invitado\", subtitle: \"¿Seguro que quieres eliminar este invitado? Esta acción no se puede deshacer\", isGroup: false, data: null },\r\n        });\r\n        dialogRefDelete.afterClosed().subscribe(async (result) => {\r\n            if (result) {\r\n                try {\r\n                    await this.dataService.deleteInvitado(id);\r\n                    //Swal.fire('Invitado eliminado', 'Se ha eliminado el invitado correctamente', 'success');\r\n                    this.openSnackBar('Invitado eliminado correctamente', 'Ok', 'bg-success');\r\n                    this.router.navigate(['home']);\r\n                }\r\n                catch (err) {\r\n                    //Swal.fire('Oops...', 'Hubo un error al eliminar al invitado', 'error');\r\n                    this.openSnackBar('Oops...Hubo un error al eliminar el invitado', 'Ok', 'bg-danger');\r\n                }\r\n            }\r\n        });\r\n    }\r\n    openSnackBar(message, action, type) {\r\n        this._snackBar.open(message, action, {\r\n            duration: 2000,\r\n            panelClass: [type]\r\n        });\r\n    }\r\n    SelectGroup(gr) {\r\n        this.grupoSelected = gr;\r\n        this.grupoInvitado = gr.id;\r\n    }\r\n    async changeInvite(grupo, invite) {\r\n        var invitadosGroup;\r\n        this.dataService.invitados\r\n            .pipe(take(1))\r\n            .subscribe((invitados) => {\r\n            invitadosGroup = invitados.filter(x => x.grupo == grupo);\r\n            let dialogRef = this.dialog.open(InviteDialogConfirmComponent, {\r\n                width: '300px',\r\n                data: { invite: invite, personas: invitadosGroup },\r\n            });\r\n            dialogRef\r\n                .afterClosed()\r\n                .pipe(take(1))\r\n                .subscribe((result => {\r\n                if (result) {\r\n                    try {\r\n                        this.persona.invitado = invite;\r\n                        this.invitadoForm.controls['invitado'].setValue(invite);\r\n                        invitadosGroup.forEach(async (inviGr) => {\r\n                            try {\r\n                                inviGr.invitado = invite;\r\n                                await this.dataService.addInvitado(inviGr);\r\n                            }\r\n                            catch (e) {\r\n                                this.openSnackBar('Oops...Hubo un error al invitar a ' + inviGr.nombre + \" \" + inviGr.apellidos, 'Ok', 'bg-danger');\r\n                            }\r\n                        });\r\n                    }\r\n                    catch (err) {\r\n                        //Swal.fire('Oops...', 'Hubo un error al eliminar al invitado', 'error');\r\n                        console.error(err);\r\n                        this.openSnackBar('Oops...Hubo un error al eliminar el invitado', 'Ok', 'bg-danger');\r\n                    }\r\n                }\r\n            }));\r\n        });\r\n    }\r\n    openDialog() {\r\n        const dialogRef = this.dialog.open(DialogAddComponent, {\r\n            width: '250px',\r\n            data: { persona: this.persona, },\r\n        });\r\n        dialogRef.afterClosed().subscribe(result => {\r\n            if (result !== undefined) {\r\n                this.grupoSelected = result;\r\n                this.grupoInvitado = result.id;\r\n            }\r\n        });\r\n    }\r\n    openBottomSheet() {\r\n        const bottomSheet = this._bottomSheet.open(SheetComponent, {\r\n            data: this.grupoSelected\r\n        });\r\n        bottomSheet.afterDismissed().subscribe(result => {\r\n            if (result !== undefined) {\r\n                this.grupoSelected = result;\r\n                this.grupoInvitado = result.id;\r\n            }\r\n        });\r\n    }\r\n};\r\nFormComponent = __decorate([\r\n    Component({\r\n        selector: 'app-form',\r\n        templateUrl: './form.component.html',\r\n        styleUrls: ['./form.component.scss'],\r\n        providers: [DataService],\r\n    })\r\n], FormComponent);\r\nexport { FormComponent };\r\n"]},"metadata":{},"sourceType":"module"}